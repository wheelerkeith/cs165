/***********************************************************************
 * Source File:
 *    Skeet ++ - main file for this game
 * Author:
 *    Br. Comeau
 * Summary:
 *    This project will impliment the Skeet game outlined in the cs165
 *    textbook.
 ************************************************************************/

#include "uiDraw.h"
#include "uiInteract.h"
#include "point.h"
#include "rifle.h"
#include "moveable.h"

#define NUM_BULLETS 5

/*****************************************
 * GAME
 * The main game class containing all the state
 *****************************************/
class Game
{
public:
   // create the game
   Game() : gameOver(false), hit(0), miss(0) {}
   
   // handle user input
   void input(const Interface & ui);

   // advance the game
   void advance();
         
   // draw stuff
   void draw(const Interface & ui) const;
   
   
private:
   
   bool gameOver;
   Rifle rifle;
   Bird *bird;
   bool hit;
   int miss;
   int score;
   Bullet bullets[NUM_BULLETS];
   
   // TODO - REQUIREMENT for this project!!!!
   //      - you must use/have a pointer to a bird object
   //      - Ie., Bird *bird;

   // TODO: add any objects or variables that are required
};

/***************************************
 * advance the game one unit of time
 ***************************************/
void Game :: advance()
{
  bird.advance();
  if (bird.isOutside())
  {
    int b = random(0, 2);
    if (b == 0)
       bird = new Safe;
    if (b == 1)
       bird = new Normal;
    if (b == 2)
       bird = new Tough;
    miss++;
  }
  
//  rifle.advance();
  
  for (int i = 0; i < NUM_BULLETS; i++)
  {
    bullets[i].advance();
  }
  
  
   // TODO: advance anything that moves
   // TODO: decide if anything died, the game is over, etc...
}

/***************************************
 * GAME :: input
 * accept input from the user
 ***************************************/
void Game :: input(const Interface & ui)
{
   // TODO: handle user input

   // Note that you can discover keys that were pressed by checking
   // methods such as ui.isUp(), ui.isLeft(), etc.
   // see Pong for an example

   // Move the the rifle
   rifle.move(ui.isRight(), ui.isLeft());
   // If space is pressed, create a bullet
   if (ui.isSpace())
   {
     for (int i = 0; i < NUM_BULLETS; i++)
       if (bullets[i].isDead())
       {
         bullets[i].fire(rifle);
         i = NUM_BULLETS;
       }
   }
}

/*********************************************
 * GAME :: DRAW
 * Draw everything on the screen
 *********************************************/
void Game :: draw(const Interface & ui) const
{
	// display the rifle
   	rifle.draw();
    bird.draw();
    for (int i = 0; i < NUM_BULLETS; i++)
    {
      if(!bullets[i].isDead())
        bullets[i].draw();
    }
    
   Point pt1 = Point(pt1.getXMin()+10,pt1.getYMax()-10);
   drawNumber(pt1,hit);

   Point pt2 = Point(pt2.getXMax()-100,pt2.getYMax()-10);
   drawNumber(pt2,miss);

    // TODO: draw anything you need to display in the game

}

#define X_SIZE       400

/*************************************
 * All the interesting work happens here, when
 * I get called back from OpenGL to draw a frame.
 * When I am finished drawing, then the graphics
 * engine will wait until the proper amount of
 * time has passed and put the drawing on the screen.
 **************************************/
void callBack(const Interface *pUI, void *p)
{
   Game *pGame = (Game *)p;

   pGame->advance();
   pGame->input(*pUI);
   pGame->draw(*pUI);
}

// set the bounds of the drawing rectangle
float Point::xMin = -(X_SIZE / 2.0);
float Point::xMax =  (X_SIZE / 2.0);
float Point::yMin = -200.0;
float Point::yMax =  200.0;

/*********************************
 * Main is pretty sparse.  Just initialize
 * the game and call the display engine.
 * That is all!
 *********************************/
int main(int argc, char ** argv)
{
   Interface ui(argc, argv, "Skeet");
   Game game;
   ui.run(callBack, &game);
   
   return 0;
}
